package io.github.qe7.features.impl.modules.impl.exploit;

import io.github.qe7.events.impl.packet.OutgoingPacketEvent;
import io.github.qe7.events.impl.player.MotionEvent;
import io.github.qe7.features.impl.modules.api.enums.ModuleCategory;
import io.github.qe7.features.impl.modules.api.Module;
import me.zero.alpine.listener.Listener;
import me.zero.alpine.listener.Subscribe;
import net.minecraft.client.Minecraft;
import net.minecraft.src.Packet10Flying;

public class AntiHungerModule extends Module {

    private boolean onGroundLast, shouldReset;

    public AntiHungerModule() {
        super("Anti Hunger", "Removes/Slows down hunger use", ModuleCategory.EXPLOIT);
    }

    @Subscribe
    public final Listener<MotionEvent> motionEventListener = new Listener<>(MotionEvent.class, event -> {
        event.setOnGround(false);
    });

    @Subscribe
    public final Listener<OutgoingPacketEvent> outgoingPacketEventListener = new Listener<>(OutgoingPacketEvent.class, event -> {
        if (event.getPacket() instanceof Packet10Flying) {
            Packet10Flying packet = (Packet10Flying) event.getPacket();

            boolean trueOnGround = Minecraft.getMinecraft().thePlayer.onGround;

            if (shouldReset && trueOnGround) {
                packet.onGround = true;
                shouldReset = false;
            }

            if (trueOnGround && !onGroundLast) {
                packet.onGround = false;
                shouldReset = true;
            }

            onGroundLast = trueOnGround;
        }
    });
}
